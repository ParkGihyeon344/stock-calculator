<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>사팔사팔 단타 계산기</title>
  <link rel="stylesheet" href="style.css" />
  <script src="script.js" defer></script>
</head>
<body>
  <main id="sapal-section">
    <h2 style="text-align:center; color:#4CAF50;">📐 사팔사팔 단타 계산기</h2>

    <!-- 초기 보유 정보 입력 -->
    <div style="margin: 20px 0; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
      <div style="display: flex; flex-wrap: wrap; gap: 20px; align-items: flex-end;">
        <div style="flex: 1; min-width: 200px;">
          <label>현재 보유수량</label>
          <input type="number" id="initialQty" placeholder="보유 수량" value="0" />
        </div>
        <div style="flex: 1; min-width: 200px;">
          <label>현재 평단가</label>
          <input type="number" id="initialAvg" placeholder="평단가" value="0" />
        </div>
        <div style="flex: 1; min-width: 200px;">
          <label>현재 수익률 (%)</label>
          <input type="number" id="initialReturn" placeholder="예: 3.5" value="0" />
        </div>
        <div style="flex: 1; min-width: 200px;">
          <label>현재 예수금</label>
          <input type="number" id="userCash" placeholder="예: 1000000" value="10000000" />
        </div>
        <div style="flex: 1; min-width: 150px;">
          <button class="submit" onclick="applyInitialHoldings()">보유 내역 적용</button>
        </div>
      </div>
    </div>

    <!-- 거래 입력 -->
    <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-top: 20px; align-items: flex-end;">
      <div style="flex: 1; min-width: 130px;">
        <label>거래 유형</label>
        <select id="tradeType">
          <option value="buy">매수</option>
          <option value="sell">매도</option>
        </select>
      </div>
      <div style="flex: 1; min-width: 130px;">
        <label>단가</label>
        <input type="number" id="tradePrice" placeholder="단가" />
      </div>
      <div style="flex: 1; min-width: 130px;">
        <label>수량</label>
        <input type="number" id="tradeQty" placeholder="수량" value="5" />
      </div>
      <div style="flex: 1; min-width: 130px;">
        <label>수수료율 (%)</label>
        <input type="number" id="tradeFee" placeholder="예: 0.15" value="0" />
      </div>
      <div style="min-width: 130px;">
        <button class="submit" onclick="addTrade()">거래 추가</button>
      </div>
    </div>

    <!-- 요약 -->
    <div class="result" style="margin-top: 30px;">
      💰 누적 손익: <span id="totalProfit">0</span>원 |
      📊 누적 수익률: <span id="totalReturn">0.00</span>%<br />
      📦 총 수량: <span id="holdQty">0</span>주 |
      💵 평단가: <span id="avgPrice">0</span>원 |
      🧾 총 매입금: <span id="totalBuy">0</span>원 |
      💸 잔여 예수금: <span id="cashRemaining">0</span>원 |
      ⏱ 진행률: <span id="progressRate">0.00</span>%
    </div>

    <!-- 컨트롤 버튼 -->
    <div style="display: flex; gap: 10px; margin: 15px 0;">
      <button onclick="resetTable()">초기화</button>
      <button onclick="copyTable()">복사</button>
      <button onclick="downloadCSV()">저장</button>
    </div>

    <!-- 거래 내역 테이블 -->
    <table>
      <thead>
        <tr>
          <th>회차</th>
          <th>시간</th>
          <th>포지션</th>
          <th>단가</th>
          <th>수량</th>
          <th>체결금액</th>
          <th>평단</th>
          <th>실현 손익</th>
          <th>누적 손익</th>
          <th>수행</th>
        </tr>
      </thead>
      <tbody id="tradeTable"></tbody>
    </table>

    <div style="margin-top: 30px; font-size: 13px; color: #666; line-height: 1.6; background: #f9f9f9; padding: 14px 18px; border-radius: 8px;">
      ⚠️ <strong>이 계산기는 투자 참고용입니다.</strong><br />
      - 이 계산기의 결과는 단순 참고용이며, 실제 투자 손익과 차이가 날 수 있습니다.<br />
      - 수수료, 세금, 슬리피지 등 모든 거래 조건이 반영되지 않을 수 있습니다.<br />
      - 본 도구는 투자 자문을 제공하지 않으며, 결과에 따른 투자 손실에 대해 책임지지 않습니다.<br />
      - 모든 투자 판단은 사용자 본인의 책임 하에 이루어져야 하며, 필요시 전문가의 조언을 받아야 합니다.
    </div>
  </main>
</body>
</html>
