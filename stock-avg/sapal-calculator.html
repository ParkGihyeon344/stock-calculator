<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>사팔사팔 계산기</title>
  <script src="script.js" defer></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-800 p-4">
  <div class="max-w-2xl mx-auto space-y-6">
    <h2 class="text-xl font-bold text-green-600">📐 사팔사팔 단타 계산기</h2>

    <!-- 보유 내역 입력 -->
    <div class="bg-white rounded-xl shadow p-4 space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="font-semibold">📦 현재 보유수량</label>
          <input id="initialQty" type="number" placeholder="보유 수량" class="input">
        </div>
        <div>
          <label class="font-semibold">📈 현재 평단가</label>
          <input id="initialAvg" type="number" placeholder="평단가" class="input">
        </div>
        <div>
          <label class="font-semibold">📊 현재 수익률 (%)</label>
          <input id="initialReturn" type="number" placeholder="예: 3.5" class="input">
        </div>
        <div>
          <label class="font-semibold">💰 현재 예수금</label>
          <input id="userCash" type="number" placeholder="예: 1000000" value="10000000" class="input">
        </div>
      </div>
      <button onclick="applyInitialHoldings()" class="w-full bg-green-500 text-white py-2 rounded-md font-bold">보유 내역 적용</button>
    </div>

    <!-- 거래 추가 입력 -->
    <div class="bg-white rounded-xl shadow p-4 space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
        <div>
          <label class="font-semibold">🛒 거래 유형</label>
          <select id="tradeType" class="input">
            <option value="buy">매수</option>
            <option value="sell">매도</option>
          </select>
        </div>
        <div>
          <label class="font-semibold">💵 단가</label>
          <input id="tradePrice" type="number" placeholder="단가" class="input">
        </div>
        <div>
          <label class="font-semibold">🔢 수량</label>
          <input id="tradeQty" type="number" placeholder="수량" value="5" class="input">
        </div>
        <div>
          <label class="font-semibold">💸 수수료율 (%)</label>
          <input id="tradeFee" type="number" placeholder="예: 0.15" value="0" class="input">
        </div>
        <div class="flex items-end">
          <button onclick="addTrade()" class="w-full bg-blue-500 text-white py-2 rounded-md">거래 추가</button>
        </div>
      </div>
    </div>

    <!-- 거래 요약 및 결과 -->
    <div class="bg-white rounded-xl shadow p-4 text-sm">
      <p>💰 <b>누적 손익:</b> <span id="totalProfit">0</span>원</p>
      <p>📊 <b>누적 수익률:</b> <span id="totalReturn">0.00</span>%</p>
      <p>📦 <b>총 수량:</b> <span id="holdQty">0</span>주</p>
      <p>💵 <b>평단가:</b> <span id="avgPrice">0</span>원</p>
      <p>🧾 <b>총 매입금:</b> <span id="totalBuy">0</span>원</p>
      <p>💸 <b>잔여 예수금:</b> <span id="cashRemaining">0</span>원</p>
      <p>⏱ <b>진행률:</b> <span id="progressRate">0.00</span>%</p>
      <div class="mt-4 flex gap-2">
        <button onclick="resetTable()" class="flex-1 bg-gray-300 py-2 rounded">초기화</button>
        <button onclick="copyTable()" class="flex-1 bg-gray-300 py-2 rounded">복사</button>
        <button onclick="downloadCSV()" class="flex-1 bg-gray-300 py-2 rounded">저장</button>
      </div>
    </div>

    <!-- 거래 내역 테이블 -->
    <div class="overflow-auto">
      <table class="table-auto w-full text-sm border mt-4">
        <thead class="bg-gray-100">
          <tr>
            <th>회차</th>
            <th>시간</th>
            <th>포지션</th>
            <th>단가</th>
            <th>수량</th>
            <th>체결금액</th>
            <th>평단</th>
            <th>실현 손익</th>
            <th>누적 손익</th>
            <th>수행</th>
          </tr>
        </thead>
        <tbody id="tradeTable"></tbody>
      </table>
    </div>

    <!-- 주의 문구 -->
    <div class="bg-yellow-50 text-gray-700 text-sm p-4 rounded-xl shadow mt-6">
      ⚠️ <strong>이 계산기는 투자 참고용입니다.</strong><br>
      - 계산 결과는 실제 투자 손익과 차이가 날 수 있으며, 세금 및 수수료가 반영되지 않을 수 있습니다.<br>
      - 본 계산기의 결과는 투자 자문이 아니며, 모든 투자 판단은 사용자 본인의 책임입니다.
    </div>
  </div>

  <style>
    .input {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
    }
  </style>
  <script>
  // 메뉴 관련 기존 코드 그대로 유지

  window.addEventListener('message', (event) => {
    if (event.data.type === 'resize') {
      const iframe = document.getElementById('calc-frame');
      iframe.style.height = event.data.height + 'px';
    } 
  });
</script>

</body>
</html>
